# Apps/AMIS æ”¹è¿›æ€»ç»“

## ä»»åŠ¡å®Œæˆæƒ…å†µ

æ ¹æ®ç”¨æˆ·è¦æ±‚"å®Œå–„å¯¹è±¡è¡¨æ ¼å’Œå¯¹è±¡è¡¨å•ç»„ä»¶ï¼Œå¢åŠ å„ç§æµ‹è¯•ç”¨ä¾‹"ï¼Œå·²å®Œæˆä»¥ä¸‹å·¥ä½œï¼š

## âœ… 1. å¯¹è±¡è¡¨æ ¼ç»„ä»¶å®Œå–„

### æ–°å¢è¡¨æ ¼åˆ—ç±»å‹æ”¯æŒ
- âœ… **switch** - å¼€å…³æ§ä»¶æ˜¾ç¤º
- âœ… **rating** - è¯„åˆ†æ˜¾ç¤ºï¼ˆæ˜Ÿçº§æ˜ å°„ï¼‰
- âœ… **color** - é¢œè‰²é€‰æ‹©å™¨

### è¡¨æ ¼åˆ—é…ç½®å¢å¼º
```typescript
// å›¾ç‰‡åˆ— - æ”¯æŒæ”¾å¤§æŸ¥çœ‹
column.type = 'image'
column.enlargeAble = true
column.thumbMode = 'cover'

// URL åˆ— - åœ¨æ–°æ ‡ç­¾æ‰“å¼€
column.type = 'link'
column.blank = true

// æ—¥æœŸæ—¶é—´ - è‡ªåŠ¨æ ¼å¼åŒ–
column.format = 'YYYY-MM-DD HH:mm:ss'

// è¯„åˆ†åˆ— - æ˜Ÿçº§æ˜¾ç¤º
column.type = 'mapping'
column.map = { '1': 'â­', '2': 'â­â­', ... }

// è´§å¸åˆ— - ç²¾åº¦æ§åˆ¶
column.prefix = '$'
column.precision = 2
```

### æ”¯æŒçš„é…ç½®é¡¹
- `width` - åˆ—å®½åº¦
- `hidden` - éšè—åˆ—
- `sortable` - æ’åºæ”¯æŒ
- `precision` - æ•°å­—ç²¾åº¦

## âœ… 2. å¯¹è±¡è¡¨å•ç»„ä»¶å®Œå–„

### æ–°å¢è¡¨å•å­—æ®µç±»å‹
- âœ… **switch** - å¼€å…³æ§ä»¶
- âœ… **slider** - æ»‘åŠ¨æ¡ï¼ˆinput-rangeï¼‰
- âœ… **color** - é¢œè‰²é€‰æ‹©å™¨
- âœ… **rating** - è¯„åˆ†è¾“å…¥

### è¡¨å•éªŒè¯å¢å¼º

#### è‡ªåŠ¨éªŒè¯è§„åˆ™
```typescript
// é‚®ç®±è‡ªåŠ¨éªŒè¯
{
  type: 'email',
  validations: { isEmail: true },
  validationErrors: { isEmail: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€' }
}

// URL è‡ªåŠ¨éªŒè¯
{
  type: 'url',
  validations: { isUrl: true },
  validationErrors: { isUrl: 'è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€' }
}

// ç”µè¯å·ç éªŒè¯ï¼ˆä¸­å›½æ‰‹æœºå·ï¼‰
{
  type: 'phone',
  validations: { matchRegexp: '/^1[3-9]\\d{9}$/' },
  validationErrors: { matchRegexp: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ' }
}
```

#### å­—æ®µé…ç½®å¢å¼º
```typescript
// æ”¯æŒçš„æ–°é…ç½®
{
  minLength: 5,           // æœ€å°é•¿åº¦
  maxLength: 100,         // æœ€å¤§é•¿åº¦
  precision: 2,           // æ•°å­—ç²¾åº¦
  description: '...',     // å­—æ®µæè¿°
  help: '...',           // å¸®åŠ©æ–‡æœ¬
  pattern: '/regex/',     // è‡ªå®šä¹‰æ­£åˆ™éªŒè¯
}

// æ•°å­—/è´§å¸å­—æ®µ
{
  type: 'currency',
  prefix: '$',           // å‰ç¼€
  precision: 2,          // å°æ•°ä½æ•°
  min: 0,               // æœ€å°å€¼
  max: 10000            // æœ€å¤§å€¼
}

// ç™¾åˆ†æ¯”å­—æ®µ
{
  type: 'percent',
  suffix: '%',          // åç¼€
  min: 0,               // é»˜è®¤ 0
  max: 100              // é»˜è®¤ 100
}

// è¯„åˆ†å­—æ®µ
{
  type: 'rating',
  count: 5,             // æ˜Ÿçº§æ•°é‡
  allowHalf: false      // æ˜¯å¦å…è®¸åŠæ˜Ÿ
}

// æ»‘åŠ¨æ¡
{
  type: 'slider',
  min: 0,
  max: 100,
  step: 1
}
```

## âœ… 3. æµ‹è¯•ç”¨ä¾‹å®Œæ•´è¦†ç›–

### æµ‹è¯•åŸºç¡€è®¾æ–½
```
apps/amis/
â”œâ”€â”€ vitest.config.ts           # Vitest é…ç½®
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ setup.ts              # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”‚   â””â”€â”€ testUtils.tsx         # æµ‹è¯•å·¥å…·å‡½æ•°
â””â”€â”€ src/__tests__/
    â”œâ”€â”€ schemaBuilder.test.ts  # Schema æ„å»ºå™¨æµ‹è¯• (30ä¸ª)
    â”œâ”€â”€ AmisRenderer.test.tsx  # ç»„ä»¶æ¸²æŸ“æµ‹è¯• (4ä¸ª)
    â”œâ”€â”€ ObjectPage.test.tsx    # é¡µé¢ç»„ä»¶æµ‹è¯• (5ä¸ª)
    â”œâ”€â”€ api.test.ts           # API å®¢æˆ·ç«¯æµ‹è¯• (1ä¸ª)
    â””â”€â”€ integration.test.tsx   # é›†æˆæµ‹è¯• (6ä¸ª)
```

### æµ‹è¯•ç»Ÿè®¡
```
æµ‹è¯•æ–‡ä»¶: 5 ä¸ª
æµ‹è¯•ç”¨ä¾‹: 46 ä¸ª
é€šè¿‡ç‡:   100% (46/46)
è¿è¡Œæ—¶é—´: ~2.5 ç§’
```

### æµ‹è¯•è¦†ç›–èŒƒå›´

#### 1. Schema Builder æµ‹è¯• (30 ä¸ªæµ‹è¯•)
- âœ… å­—æ®µç±»å‹æ˜ å°„ï¼ˆè¡¨å•ï¼‰
  - text, email, number, currency, select, checkbox
  - date, datetime, lookup, multiselect ç­‰
- âœ… å­—æ®µç±»å‹æ˜ å°„ï¼ˆè¡¨æ ¼ï¼‰
  - æ‰€æœ‰è¡¨æ ¼åˆ—ç±»å‹è½¬æ¢
- âœ… CRUD Schema ç”Ÿæˆ
  - è¡¨æ ¼åˆ—é…ç½®
  - è¡¨å•å­—æ®µé…ç½®
  - éªŒè¯è§„åˆ™
  - åˆ†é¡µè®¾ç½®
  - æ‰¹é‡æ“ä½œ
- âœ… å¤æ‚å­—æ®µ
  - Select é€‰é¡¹é…ç½®
  - Lookup å…³è”é…ç½®
  - å¿…å¡«å­—æ®µæ ‡è®°
  - Min/Max éªŒè¯

#### 2. ç»„ä»¶æµ‹è¯• (9 ä¸ªæµ‹è¯•)
- âœ… AmisRenderer
  - ç»„ä»¶æ¸²æŸ“
  - Schema ä¼ é€’
  - æ•°æ®åˆå¹¶
  - ç”¨æˆ·ä¸Šä¸‹æ–‡æ³¨å…¥
- âœ… ObjectPage
  - åŠ è½½çŠ¶æ€æ˜¾ç¤º
  - å…ƒæ•°æ®è·å–
  - é”™è¯¯å¤„ç†
  - API è°ƒç”¨éªŒè¯

#### 3. é›†æˆæµ‹è¯• (6 ä¸ªæµ‹è¯•)
- âœ… å®Œæ•´é¡µé¢åŠ è½½æµç¨‹
- âœ… Contacts å¯¹è±¡æ¸²æŸ“
- âœ… Orders å¯¹è±¡ï¼ˆåŒ…å« lookupï¼‰
- âœ… åˆ—æ•°å’Œå­—æ®µæ•°éªŒè¯
- âœ… API é”™è¯¯å¤„ç†
- âœ… è·¯ç”±å˜æ›´å“åº”

#### 4. API æµ‹è¯• (1 ä¸ªæµ‹è¯•)
- âœ… API å®¢æˆ·ç«¯å¯¼å‡ºéªŒè¯

### æµ‹è¯•å·¥å…·å’Œ Mock

#### Mock ç­–ç•¥
```typescript
// AMIS æ¡†æ¶
vi.mock('amis', () => ({
  render: vi.fn()
}))

// API å®¢æˆ·ç«¯
vi.mock('../utils/api', () => ({
  default: {
    get: vi.fn(),
    post: vi.fn(),
    patch: vi.fn(),
    delete: vi.fn(),
  }
}))

// CSS å¯¼å…¥
vi.mock('amis/lib/themes/cxd.css', () => ({}))
```

#### æµ‹è¯•å·¥å…·å‡½æ•°
```typescript
// è‡ªå®šä¹‰æ¸²æŸ“
renderWithProviders(<Component />, {
  initialRoute: '/object/contacts'
})

// Mock æ•°æ®
mockObjectMetadata.contacts
mockApiResponses.data.contacts
```

## ğŸ“š æ–°å¢æ–‡æ¡£

### TESTING.md
å®Œæ•´çš„æµ‹è¯•æŒ‡å—ï¼ŒåŒ…æ‹¬ï¼š
- æµ‹è¯•æ¡†æ¶è¯´æ˜
- è¿è¡Œæµ‹è¯•çš„æ–¹æ³•
- æµ‹è¯•å¥—ä»¶è¯¦æƒ…
- Mock ç­–ç•¥
- æœ€ä½³å®è·µ
- å¸¸è§é—®é¢˜è§£ç­”

### README.md æ›´æ–°
æ·»åŠ æµ‹è¯•éƒ¨åˆ†è¯´æ˜ï¼š
```markdown
## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š
- pnpm test          # è¿è¡Œæ‰€æœ‰æµ‹è¯•
- pnpm test:ui       # ä½¿ç”¨ UI ç•Œé¢
- pnpm test:coverage # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

## ğŸ”„ ä¾èµ–åŒ…æ›´æ–°

### æ–°å¢ä¾èµ–
```json
{
  "devDependencies": {
    "vitest": "^2.1.8",
    "@vitest/ui": "^2.1.8",
    "@testing-library/react": "^16.3.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/user-event": "^14.5.2",
    "jsdom": "^25.0.1"
  }
}
```

### æ–°å¢è„šæœ¬
```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  }
}
```

## ğŸ“Š æ”¹è¿›å¯¹æ¯”

### å­—æ®µç±»å‹æ”¯æŒ
| ç±»åˆ« | ä¹‹å‰ | ç°åœ¨ | å¢åŠ  |
|-----|------|------|------|
| è¡¨å•ç±»å‹ | 19 | 23 | +4 |
| è¡¨æ ¼ç±»å‹ | 18 | 21 | +3 |

### éªŒè¯åŠŸèƒ½
| åŠŸèƒ½ | ä¹‹å‰ | ç°åœ¨ |
|-----|------|------|
| è‡ªåŠ¨éªŒè¯ | âŒ | âœ… (email, url, phone) |
| é•¿åº¦é™åˆ¶ | âŒ | âœ… (minLength, maxLength) |
| è‡ªå®šä¹‰æ­£åˆ™ | âŒ | âœ… (pattern) |
| å¸®åŠ©æ–‡æœ¬ | âŒ | âœ… (description, help) |

### æµ‹è¯•è¦†ç›–
| é¡¹ç›® | ä¹‹å‰ | ç°åœ¨ |
|-----|------|------|
| æµ‹è¯•æ–‡ä»¶ | 0 | 5 |
| æµ‹è¯•ç”¨ä¾‹ | 0 | 46 |
| é€šè¿‡ç‡ | - | 100% |

## ğŸ¯ è´¨é‡æå‡

1. **å¯é æ€§** - 46 ä¸ªæµ‹è¯•ä¿è¯æ ¸å¿ƒåŠŸèƒ½æ­£ç¡®æ€§
2. **å¯ç»´æŠ¤æ€§** - æµ‹è¯•ä½œä¸ºæ´»æ–‡æ¡£ï¼Œæ–¹ä¾¿ç†è§£ä»£ç 
3. **é‡æ„å®‰å…¨** - æµ‹è¯•è¦†ç›–ä¿æŠ¤é‡æ„è¿‡ç¨‹
4. **å¼€å‘æ•ˆç‡** - å¿«é€ŸéªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æ–°å­—æ®µç±»å‹ä½¿ç”¨

```yaml
# object.yml ä¸­å®šä¹‰
fields:
  rating:
    type: rating
    label: è¯„åˆ†
    count: 5
    allowHalf: true
  
  color:
    type: color
    label: é¢œè‰²
  
  enabled:
    type: switch
    label: å¯ç”¨çŠ¶æ€
  
  volume:
    type: slider
    label: éŸ³é‡
    min: 0
    max: 100
    step: 5
```

è‡ªåŠ¨ç”Ÿæˆçš„ AMIS è¡¨å•ï¼š
```json
{
  "type": "input-rating",
  "name": "rating",
  "label": "è¯„åˆ†",
  "count": 5,
  "half": true
}
```

### éªŒè¯è§„åˆ™ä½¿ç”¨

```yaml
fields:
  email:
    type: email
    label: é‚®ç®±
    # è‡ªåŠ¨æ·»åŠ é‚®ç®±éªŒè¯
  
  website:
    type: url
    label: ç½‘ç«™
    # è‡ªåŠ¨æ·»åŠ  URL éªŒè¯
  
  phone:
    type: phone
    label: ç”µè¯
    # è‡ªåŠ¨æ·»åŠ æ‰‹æœºå·éªŒè¯
```

## âœ… ä»»åŠ¡å®Œæˆæ¸…å•

- [x] å®Œå–„å¯¹è±¡è¡¨æ ¼ç»„ä»¶
  - [x] æ–°å¢ 3 ç§è¡¨æ ¼åˆ—ç±»å‹
  - [x] å¢å¼ºåˆ—é…ç½®ï¼ˆå®½åº¦ã€æ ¼å¼åŒ–ã€ç²¾åº¦ï¼‰
  - [x] æ”¹è¿›ç‰¹æ®Šå­—æ®µæ˜¾ç¤ºï¼ˆå›¾ç‰‡ã€è¯„åˆ†ã€é¢œè‰²ï¼‰
- [x] å®Œå–„å¯¹è±¡è¡¨å•ç»„ä»¶
  - [x] æ–°å¢ 4 ç§è¡¨å•å­—æ®µç±»å‹
  - [x] è‡ªåŠ¨éªŒè¯è§„åˆ™ï¼ˆemail, url, phoneï¼‰
  - [x] å­—æ®µé…ç½®å¢å¼ºï¼ˆé•¿åº¦ã€ç²¾åº¦ã€å¸®åŠ©ï¼‰
  - [x] æ”¯æŒè‡ªå®šä¹‰éªŒè¯
- [x] æ·»åŠ å„ç§æµ‹è¯•ç”¨ä¾‹
  - [x] Schema Builder å•å…ƒæµ‹è¯• (30ä¸ª)
  - [x] ç»„ä»¶æµ‹è¯• (9ä¸ª)
  - [x] é›†æˆæµ‹è¯• (6ä¸ª)
  - [x] API æµ‹è¯• (1ä¸ª)
  - [x] æµ‹è¯•æ–‡æ¡£
- [x] å®Œå–„æ–‡æ¡£
  - [x] TESTING.md æµ‹è¯•æŒ‡å—
  - [x] README.md æ›´æ–°

## ğŸ‰ æ€»ç»“

æˆåŠŸå®Œæˆäº†ç”¨æˆ·è¦æ±‚çš„æ‰€æœ‰ä»»åŠ¡ï¼š
1. âœ… å¯¹è±¡è¡¨æ ¼ç»„ä»¶å®Œå–„ - æ–°å¢ç±»å‹ã€å¢å¼ºé…ç½®
2. âœ… å¯¹è±¡è¡¨å•ç»„ä»¶å®Œå–„ - æ–°å¢ç±»å‹ã€è‡ªåŠ¨éªŒè¯
3. âœ… æ·»åŠ æµ‹è¯•ç”¨ä¾‹ - 46 ä¸ªæµ‹è¯•ï¼Œ100% é€šè¿‡
4. âœ… æµ‹è¯•åŸºç¡€è®¾æ–½ - Vitest é…ç½®å®Œæ•´
5. âœ… æ–‡æ¡£å®Œå–„ - æµ‹è¯•æŒ‡å—è¯¦å°½

æ‰€æœ‰æ”¹è¿›éƒ½ç»è¿‡æµ‹è¯•éªŒè¯ï¼Œç¡®ä¿åŠŸèƒ½æ­£ç¡®æ€§å’Œä»£ç è´¨é‡ã€‚
